<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Envoltória Convexa - Força bruta O(n³)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      padding: 20px;
    }

    canvas {
      border: 1px solid #ccc;
      margin-top: 10px;
      cursor: crosshair;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
      justify-content: center;
    }

    button {
      padding: 8px 12px;
      font-size: 14px;
      cursor: pointer;
      background: #f5f5f5;
      border: 1px solid #ccc;
      border-radius: 4px;
      transition: background 0.2s;
    }

    button:hover {
      background: #e5e5e5;
    }

    .delay-control {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    input[type="range"] {
      width: 120px;
    }

    #status {
		margin-top: 10px;
		font-size: 25px;   
		font-weight: bold;
		color: #333;
	}
  </style>
</head>
<body>
  <h2>Envoltória Convexa - Força bruta O(n³)</h2>
  <div class="controls">
    <button id="resetBtn">Resetar</button>
    <button id="playBtn">Play</button>
    <button id="prevBtn">Voltar</button>
    <button id="nextBtn">Avançar</button>
    <div class="delay-control">
      <label for="delayRange">Delay:</label>
      <input type="range" id="delayRange" min="100" max="5000" step="100" value="300" />
      <span id="delayValue">300 ms</span>
    </div>
  </div>
  <canvas id="canvas" width="600" height="400"></canvas>
  <div id="status">Passo: -</div>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const delayRange = document.getElementById("delayRange");
    const delayValue = document.getElementById("delayValue");
    const statusDiv = document.getElementById("status");

    let points = [];
    let steps = [];
    let currentStep = 0;
    let playing = false;
    let delay = parseInt(delayRange.value);
    let intervalId = null;

    delayRange.addEventListener("input", () => {
      delay = parseInt(delayRange.value);
      delayValue.textContent = `${delay} ms`;
    });

    canvas.addEventListener("click", (e) => {
      if (playing) return;
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      points.push({ x, y });
      draw();
    });

    function draw(pointsToHighlight = [], hullLines = []) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Linhas da envoltória
      ctx.strokeStyle = "red";
      ctx.lineWidth = 2;
      for (const line of hullLines) {
        ctx.beginPath();
        ctx.moveTo(line[0].x, line[0].y);
        ctx.lineTo(line[1].x, line[1].y);
        ctx.stroke();
      }

      // Pontos
      ctx.fillStyle = "blue";
      ctx.font = "12px Arial";
      points.forEach((p, i) => {
        ctx.beginPath();
        ctx.arc(p.x, p.y, 5, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillText(i + 1, p.x + 8, p.y - 8);
      });

      // Linha em teste
      if (pointsToHighlight.length === 2) {
        const [p1, p2] = pointsToHighlight;

        // Linha tracejada cinza entre os pontos
        ctx.strokeStyle = "gray";
        ctx.setLineDash([5, 5]);
        ctx.beginPath();
        ctx.moveTo(p1.x, p1.y);
        ctx.lineTo(p2.x, p2.y);
        ctx.stroke();
        ctx.setLineDash([]);

        // Linha vermelha atravessando o canvas
        ctx.strokeStyle = "red";
        ctx.lineWidth = 1;
        const dx = p2.x - p1.x;
        const dy = p2.y - p1.y;

        if (dx === 0) {
          ctx.beginPath();
          ctx.moveTo(p1.x, 0);
          ctx.lineTo(p1.x, canvas.height);
          ctx.stroke();
        } else {
          const m = dy / dx;
          const b = p1.y - m * p1.x;
          const x0 = 0;
          const y0 = m * x0 + b;
          const x1 = canvas.width;
          const y1 = m * x1 + b;
          ctx.beginPath();
          ctx.moveTo(x0, y0);
          ctx.lineTo(x1, y1);
          ctx.stroke();
        }
      }
    }

    function orientation(p, q, r) {
      return (q.y - p.y) * (r.x - q.x) - (q.x - p.x) * (r.y - q.y);
    }

    function generateSteps() {
      steps = [];
      const hull = [];

      for (let i = 0; i < points.length; i++) {
        for (let j = i + 1; j < points.length; j++) {
          let left = false, right = false;
          for (let k = 0; k < points.length; k++) {
            if (k === i || k === j) continue;
            const o = orientation(points[i], points[j], points[k]);
            if (o > 0) left = true;
            else if (o < 0) right = true;
          }
          // Adiciona passo de teste
          steps.push({ test: [points[i], points[j]], hull: [...hull], isHull: !(left && right) });
          if (!(left && right)) {
            hull.push([points[i], points[j]]);
            steps.push({ test: [points[i], points[j]], hull: [...hull], isHull: true });
          }
        }
      }
    }

    function showStep() {
      if (steps.length === 0) return;
      const s = steps[currentStep];
      draw(s.test, s.hull);

      const i = points.indexOf(s.test[0]) + 1;
      const j = points.indexOf(s.test[1]) + 1;
      const statusText = `Passo: ${i} - ${j}` + (s.isHull ? " ✅ Aresta" : "");
      statusDiv.textContent = statusText;
    }

    function playAnimation() {
      if (!playing) {
        if (steps.length === 0) generateSteps();
        playing = true;
        document.getElementById("playBtn").textContent = "Pause";
        intervalId = setInterval(() => {
          showStep();
          currentStep++;
          if (currentStep >= steps.length) {
            clearInterval(intervalId);
            playing = false;
            document.getElementById("playBtn").textContent = "Play";
          }
        }, delay);
      } else {
        clearInterval(intervalId);
        playing = false;
        document.getElementById("playBtn").textContent = "Play";
      }
    }

    document.getElementById("resetBtn").addEventListener("click", () => {
      points = [];
      steps = [];
      currentStep = 0;
      playing = false;
      clearInterval(intervalId);
      document.getElementById("playBtn").textContent = "Play";
      statusDiv.textContent = "Passo: -";
      draw();
    });

    document.getElementById("playBtn").addEventListener("click", playAnimation);

    document.getElementById("nextBtn").addEventListener("click", () => {
      if (steps.length === 0) return;
      currentStep = Math.min(currentStep + 1, steps.length - 1);
      showStep();
    });

    document.getElementById("prevBtn").addEventListener("click", () => {
      if (steps.length === 0) return;
      currentStep = Math.max(currentStep - 1, 0);
      showStep();
    });
  </script>
</body>
</html>
